---
title             : "Writing reproducible manuscripts in RMarkdown: BEAM lab demonstration"
shorttitle        : "BEAM demo"

author: 
  - name          : "Jade Pickering"
    affiliation   : "1,2"
    corresponding : yes    # Define only one corresponding author
    address       : "Zochonis Building, University of Manchester"
    email         : "jade.pickering@manchester.ac.uk"

affiliation:
  - id            : "1"
    institution   : "University of Manchester"
  - id            : "2"
    institution   : "University of York"

authornote: |
  This demo was funded by nobody and there are no conflicts of interest.

abstract: |
  Work in progress :)
  
keywords          : "BEAM, RMarkdown, Papaja, demo"
wordcount         : "X"

bibliography      : ["r-references.bib", "refs/references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
#classoption       : "man"
classoption       : "doc"
output            : papaja::apa6_pdf


---

```{r setup, include = FALSE}
library(papaja)
library(knitr)
library(tidyverse)
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

# Introduction
Here is the first sentence of my introduction. I can write things in *italics* using an asterisk at each end, and I can emphasise words in **bold** using double asterisks using general markdown formatting.

## Aims
We were interested in comparing the area of the petals of three different species of iris [@anderson1936species], see Figure \@ref(fig:iris-pic) for a visual example. <!-- I added in a random reference to a random paper about irises for demonstration purposes, which is in the references.bib file in the "refs" folder of the project. You can see it's automatically added it to the reference list at the end, seamlessly with the R package references -->


```{r iris-pic, fig.cap="The iris genus, from left to right: setosa, versicolor, virginica", out.width="30%", out.height="30%", fig.show = "hold"}

# this chunk is for creating a figure
# 'include_graphics' is part of the knitr package, and pulls in external image files

include_graphics(c("figs/iris-setosa.jpg","figs/iris-versicolor.jpg", "figs/iris-virginica.jpg")) # we can use relative path info because we've made a project which is automatically our default working directory


```

# Methods

## Data collection
We looked at a sample of flowers from three different species from the iris genus (setosa, versicolor, and virginica) and measured their petals and sepals.

```{r import-data}

# HYPOTHETICAL SCENARIO:
# We've started data collection for our pre-registered study so we already know what analysis we'll do
# We've collected a few samples (and even if we hadn't, we could simulate it!) so we can start writing our paper before we know the results
# For the purposes of the demo I've just taken a "slice" of the iris dataset which is included with R (5 samples per group)

my_data <- iris %>%
  slice(1:5,51:55,101:105)

# If you run it like you would any regular R code (highlight it and then Ctrl+Enter to run OR clicking the green arrow "Run Current Chunk") the data should then open in the environment to the right
# We can get take a quick look at it by running "my_data" in the console

# To see the WHOLE dataset, like I did at the end of the demo, comment out the previous bit of code by adding hashes # to the beginning, and run this (after uncommenting) instead:
# my_data <- iris


```


## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.

We  calculated the area of the petals by multiplying the petal width by the petal length.


```{r summary-stats}

# we can get have a look at some summary statistics in another code chunk.

# I want to (very crudely) work out the approximate area of the petals using the Petal.Length and Petal.Width variables
my_data2 <- my_data %>%
  mutate(Petal.Area = Petal.Length*Petal.Width)

# And I want some means and SDs that I can refer to in-text shortly
iris_summary <- my_data2 %>%
  group_by(., Species) %>%
  summarise(pl_mean = mean(Petal.Length),
            pl_sd = sd(Petal.Length),
            pw_mean = mean(Petal.Width),
            pw_sd = sd(Petal.Width),
            pa_mean = mean(Petal.Area),
            pa_sd = sd(Petal.Area)) %>%
   as.data.frame()


``` 


# Results

We found that the setosa species had a mean petal area of `r printnum(iris_summary['1', 'pa_mean'])` (SD = `r printnum(iris_summary['1', 'pa_sd'])`), and the versicolor species had a mean petal area of `r printnum(iris_summary['2', 'pa_mean'])` (SD = `r printnum(iris_summary['2', 'pa_sd'])`), and the virginica species had a mean petal area of `r printnum(iris_summary['3', 'pa_mean'])` (SD = `r printnum(iris_summary['3', 'pa_sd'])`).


```{r iris-correlation, fig.cap="Correlation between petal length and petal width for each of the iris species"}

# creating a graph using ggplot
p1 <- ggplot(my_data, aes(x = Petal.Length, y = Petal.Width, fill = Species, colour = Species)) +
  geom_point(alpha = 0.5) +
  theme_apa()
  
p1 # can run this in the console or just run the chunk to see what the plot looks like without needing to "knit" the document

```

We plotted correlations between petal width and length (see Figure \@ref(fig:iris-correlation)). <!-- we're using this to refer to the code chunk  which we named "iris-correlation". The ref starts with "fig:" so that R knows to refer to it as a figure and keep the numbering in order without us worrying about it. -->


```{r anova-iris, results = "asis"}
# NB: adding "results = "asis"" to our chunk options enables the table to show up in the format we want it.

iris_aov <- aov(Petal.Area ~ Species, data = my_data2) # run a basic ANOVA

iris_aov_apa <- apa_print(iris_aov) # this allows us to report the statistics in-text in APA format

apa_table(iris_aov_apa$table, caption = "ANOVA summary table for the main effect of species (three levels: setosa, versicolor, virginica)") # this will generate an APA format table in our document

```

Using a repeated measures ANOVA we compared petal areas for each of the three species and performed one-tailed comparisons to see whether the virginica species has a significantly larger petal area than the setosa species, and whether the versicolor species has a significantly larger petal area than setosa.

A summary of the ANOVA can be found in Table \@ref(tab:anova-iris).

We found that there was a significant effect of species (`r iris_aov_apa$full$Species`).


<!-- OPTIONAL TASK: how would we code the a-priori t-test comparisons and report them reproducibly? -->


# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
